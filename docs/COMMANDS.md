# コマンドリファレンス

このドキュメントでは、面接予約システムで利用可能なすべてのコマンドについて詳しく説明します。

## 📋 目次

- [予約管理コマンド](#予約管理コマンド)
  - [/reserve - 予約作成](#reserve---予約作成)
  - [/cancel - 予約取り消し](#cancel---予約取り消し)
  - [/complete - 予約完了](#complete---予約完了)
- [表示コマンド](#表示コマンド)
  - [/list - すべての予約を表示](#list---すべての予約を表示)
  - [/my-reservations - 自分の予約を表示](#my-reservations---自分の予約を表示)
- [ユーティリティコマンド](#ユーティリティコマンド)
  - [/help - ヘルプ表示](#help---ヘルプ表示)
  - [/feedback - フィードバック送信](#feedback---フィードバック送信)

---

## 予約管理コマンド

### /reserve - 予約作成

面接の予約を作成します。

**パラメータ:**
- `date` (必須): 予約日
  - 形式: `YYYY-MM-DD` または `YYYY/MM/DD`
  - 例: `2025-10-15` または `2025/10/15`
- `start_time` (必須): 開始時間
  - 形式: `HH:MM`
  - 例: `14:00`
- `end_time` (オプション): 終了時間
  - 形式: `HH:MM`
  - 例: `15:00`
  - 省略時: 開始時刻+1時間が自動設定されます
- `comment` (オプション): コメント
  - 任意のメモや備考を入力できます

**使用例:**
```
/reserve date:2025-10-15 start_time:14:00 end_time:15:00 comment:面接準備あり
```

**動作:**
1. 時間の重複をチェック（他の予約と重複する場合はエラー）
2. 推測しにくい予約IDを自動生成
3. 予約者には予約IDをプライベートメッセージで通知
4. チャンネルには予約情報を公開通知（IDは含まない）

**通知例:**

*本人のみに見えるメッセージ:*
```
✅ 予約が作成されました

📋 予約ID: abc123def456
📅 日時: 2025年10月15日 14:00 - 15:00
👤 予約者: あなた
📝 コメント: 面接準備あり
```

*チャンネル全体に見えるメッセージ:*
```
📅 新しい予約が作成されました

📅 日時: 2025年10月15日 14:00 - 15:00
👤 予約者: ユーザー名
📝 コメント: 面接準備あり
```

---

### /cancel - 予約取り消し

既存の予約を取り消します。

**パラメータ:**
- `reservation_id` (必須): 予約ID
  - 予約作成時に通知されたIDを入力
- `comment` (オプション): キャンセル理由
  - 任意のメモや備考を入力できます

**使用例:**
```
/cancel reservation_id:abc123def456 comment:都合が悪くなりました
```

**動作:**
1. 予約IDが存在するかチェック
2. 予約のステータスを `cancelled` に変更
3. キャンセル通知をチャンネルに送信

**通知例:**
```
🚫 予約がキャンセルされました

📋 予約ID: abc123def456
📅 日時: 2025年10月15日 14:00 - 15:00
👤 予約者: ユーザー名
📝 キャンセル理由: 都合が悪くなりました
```

**注意:**
- キャンセル済みの予約は30日後に自動的に削除されます

---

### /complete - 予約完了

予約を完了状態にします。

**パラメータ:**
- `reservation_id` (必須): 予約ID
  - 予約作成時に通知されたIDを入力
- `comment` (オプション): 完了メモ
  - 任意のメモや備考を入力できます

**使用例:**
```
/complete reservation_id:abc123def456 comment:面接完了しました
```

**動作:**
1. 予約IDが存在するかチェック
2. 予約のステータスを `completed` に変更
3. 完了通知をチャンネルに送信

**通知例:**
```
✅ 予約が完了しました

📋 予約ID: abc123def456
📅 日時: 2025年10月15日 14:00 - 15:00
👤 予約者: ユーザー名
📝 メモ: 面接完了しました
```

**注意:**
- 完了済みの予約は30日後に自動的に削除されます
- 終了時刻が過ぎた予約は毎日午前3時に自動的に完了状態になります

---

## 表示コマンド

### /list - すべての予約を表示

すべての予約を一覧表示します。

**パラメータ:** なし

**使用例:**
```
/list
```

**動作:**
1. すべての予約を取得
2. ステータス別（予約中、完了、キャンセル済み）にグループ化
3. 日時順にソート
4. **コマンドを実行した人にのみ表示**（他のユーザーには見えません）

**表示例:**
```
📋 予約一覧

━━━━━━━━━━━━━━━━━━━━
📅 予約中 (2件)
━━━━━━━━━━━━━━━━━━━━

📋 予約ID: abc123
📅 日時: 2025/10/15 14:00 - 15:00
👤 予約者: ユーザーA
📝 コメント: 面接準備あり

📋 予約ID: def456
📅 日時: 2025/10/16 10:00 - 11:00
👤 予約者: ユーザーB

━━━━━━━━━━━━━━━━━━━━
✅ 完了 (1件)
━━━━━━━━━━━━━━━━━━━━

📋 予約ID: ghi789
📅 日時: 2025/10/14 13:00 - 14:00
👤 予約者: ユーザーC
```

**プライバシー:**
- ✅ コマンドを打った人にしか見えません
- ✅ 他のユーザーには表示されません
- ✅ すべての予約情報（ID含む）が確認できます

---

### /my-reservations - 自分の予約を表示

自分が作成した予約のみを表示します。

**パラメータ:** なし

**使用例:**
```
/my-reservations
```

**動作:**
1. コマンドを実行したユーザーの予約のみを取得
2. ステータス別（予約中、完了、キャンセル済み）にグループ化
3. 日時順にソート
4. **コマンドを実行した人にのみ表示**（他のユーザーには見えません）

**表示例:**
```
👤 あなたの予約

━━━━━━━━━━━━━━━━━━━━
📅 予約中 (1件)
━━━━━━━━━━━━━━━━━━━━

📋 予約ID: abc123
📅 日時: 2025/10/15 14:00 - 15:00
📝 コメント: 面接準備あり

━━━━━━━━━━━━━━━━━━━━
✅ 完了 (1件)
━━━━━━━━━━━━━━━━━━━━

📋 予約ID: ghi789
📅 日時: 2025/10/14 13:00 - 14:00

現在、予約中の予約が1件あります。
```

**プライバシー:**
- ✅ コマンドを打った人にしか見えません
- ✅ 自分の予約のみが表示されます

---

## ユーティリティコマンド

### /help - ヘルプ表示

コマンド一覧とヘルプメッセージを表示します。

**パラメータ:** なし

**使用例:**
```
/help
```

**動作:**
1. すべてのコマンドの説明を表示
2. 各コマンドのパラメータと使用方法を説明
3. **コマンドを実行した人にのみ表示**（他のユーザーには見えません）

**表示内容:**
- すべてのコマンドのリスト
- 各コマンドの説明
- パラメータの詳細
- プライバシーに関する情報
- データ管理に関する情報

**プライバシー:**
- ✅ コマンドを打った人にしか見えません
- ✅ チャンネルを汚しません

---

### /feedback - フィードバック送信

システムへのご意見・ご要望を匿名で送信します。

**パラメータ:**
- `message` (必須): フィードバック内容
  - ご意見、ご要望、バグ報告など、自由に記入できます

**使用例:**
```
/feedback message:予約の編集機能があると便利だと思います
```

**動作:**
1. フィードバック内容を受け取る
2. 特定のフィードバックチャンネルに匿名で転送
3. 送信者に確認メッセージを表示
4. **コマンド自体は実行した人にのみ表示**（他のユーザーには見えません）

**送信者に見えるメッセージ:**
```
✅ フィードバックを送信しました

ご意見ありがとうございます。
あなたのフィードバックは匿名で運営チームに届けられました。

今後のシステム改善に活用させていただきます。
```

**フィードバックチャンネルに表示される内容:**
```
💬 新しいフィードバック

予約の編集機能があると便利だと思います

━━━━━━━━━━━━━━━━━━━━
受信日時: 2025-11-09 15:30:00 | 匿名フィードバック
```

**プライバシー:**
- ✅ 完全匿名で送信されます
- ✅ 誰が送信したかは運営チームにも分かりません
- ✅ コマンド実行自体も他のユーザーには見えません
- ✅ ログにはメッセージの長さのみ記録（内容は記録されません）

**注意:**
- `FEEDBACK_CHANNEL_ID` 環境変数が設定されていない場合、このコマンドは使用できません
- 管理者は `.env` ファイルでフィードバックチャンネルを設定する必要があります

---

## 🔒 プライバシーに関する注意事項

### コマンドを打った人にしか見えないコマンド
以下のコマンドは、実行した人にのみメッセージが表示されます（Ephemeralメッセージ）：

- `/list` - すべての予約を表示
- `/my-reservations` - 自分の予約を表示
- `/help` - ヘルプ表示
- `/feedback` - フィードバック送信

これらのコマンドを実行しても、チャンネルには何も表示されず、他のユーザーに通知されることはありません。

### 予約IDの取り扱い
- 予約作成時、予約IDは**予約者本人にのみ**プライベートメッセージで通知されます
- チャンネルに表示される公開通知には予約IDは含まれません
- 予約IDは推測しにくいランダムな文字列で生成されます

### フィードバックの匿名性
- `/feedback` コマンドで送信されたメッセージは完全に匿名化されます
- 送信者の情報（ユーザーID、ユーザー名など）は一切含まれません
- ログにはメッセージの長さのみが記録され、内容は保存されません

---

## 🗑️ データ管理

### 自動クリーンアップ
- **完了済み・キャンセル済みの予約**: 30日後に自動削除
- **期限切れの予約**: 毎日午前3時に自動完了

詳細は [CLEANUP.md](CLEANUP.md) を参照してください。

### 手動での削除
現時点では、予約の手動削除機能はありません。予約を削除したい場合は、`/cancel` コマンドでキャンセルしてください。キャンセルされた予約は30日後に自動的に削除されます。

---

## 💡 よくある質問

### Q: 予約IDを忘れてしまいました
A: `/my-reservations` コマンドで自分の予約を確認できます。予約IDも表示されます。

### Q: 他の人の予約IDを見ることはできますか？
A: `/list` コマンドですべての予約（ID含む）を確認できますが、このコマンドは実行した人にしか見えません。

### Q: 予約を編集することはできますか？
A: 現時点では編集機能はありません。一度キャンセルして、新しく予約を作成してください。

### Q: フィードバックを送信したことは他の人に分かりますか？
A: いいえ、`/feedback` コマンド自体があなたにしか見えないため、誰にも分かりません。

### Q: 予約の時間が重複するとどうなりますか？
A: エラーメッセージが表示され、予約は作成されません。別の時間を選択してください。

---

## 🛠️ 管理者向け情報

### 環境変数の設定

フィードバック機能を有効にするには、`.env` ファイルに以下を追加してください：

```env
FEEDBACK_CHANNEL_ID=your_feedback_channel_id_here
```

フィードバックチャンネルIDの取得方法：
1. Discordの設定で「開発者モード」を有効化
2. フィードバックを受け取りたいチャンネルを右クリック
3. 「IDをコピー」を選択
4. `.env` ファイルに貼り付け

### コマンドの登録

新しいコマンド（`/help` と `/feedback`）は、Botを再起動すると自動的に登録されます。

```bash
make run  # または go run main.go
```

GUILD_IDが設定されている場合は即座に反映されます。グローバルコマンドの場合は最大1時間かかります。

---

## 📚 関連ドキュメント

- [README.md](../README.md) - プロジェクト概要とセットアップ
- [QUICKSTART.md](QUICKSTART.md) - クイックスタートガイド
- [CLEANUP.md](CLEANUP.md) - クリーンアップ機能の詳細
- [DEVELOPMENT.md](DEVELOPMENT.md) - 開発者向けガイド
